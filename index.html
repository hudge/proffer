<!doctype html>
<html>
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <title>Proffer by hudge</title>
    
    <link rel="stylesheet" href="stylesheets/styles.css">
    <link rel="stylesheet" href="stylesheets/pygment_trac.css">
    <script src="javascripts/scale.fix.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1>Proffer</h1>
        <p>An Action Controller module to hide instance variables from views by default.</p>
        <p class="view"><a href="https://github.com/hudge/proffer">View the Project on GitHub <small>hudge/proffer</small></a></p>
        <ul>
          <li><a href="https://github.com/hudge/proffer/zipball/master">Download <strong>ZIP File</strong></a></li>
          <li><a href="https://github.com/hudge/proffer/tarball/master">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/hudge/proffer">Fork On <strong>GitHub</strong></a></li>
        </ul>
      </header>
      <section>
        <p><a href="http://travis-ci.org/hudge/proffer"><img src="https://secure.travis-ci.org/hudge/proffer.png?branch=master" alt="Build Status"></a></p>

<p>A module to stop Action Controller from copying every instance variable available
to an action to the view by default. Instead, Proffer provides a way to explicitly
expose values as local variables within views.</p>

<h3>Rationale</h3>

<p>By default, Action Controller will make any instance variables present during an
action available to its views (including partials). This effectively makes them
global variables and can obscure their origin when maintaining views. Partials
that exploit this behaviour can be particularly difficult to maintain as they
may inherit state from their caller implicitly.</p>

<p>We want to see if removing this default behaviour changes the way views are
written. By forcing explicit declaration of dependencies, will better, more
encapsulated design result?</p>

<h3>Usage</h3>

<p>Add the following to your <code>Gemfile</code>:</p>

<div class="highlight">
<pre><span class="n">gem</span> <span class="s1">'proffer'</span>
</pre>
</div>


<p>Include the <code>Proffer</code> module into any controllers you wish (include into
<code>ApplicationController</code> to enforce this behaviour throughout your application):</p>

<div class="highlight">
<pre><span class="k">class</span> <span class="nc">PostsController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
  <span class="kp">include</span> <span class="no">Proffer</span>

  <span class="c1"># This will make a new Post object available as post in the view but</span>
  <span class="c1"># @heading will be nil.</span>
  <span class="k">def</span> <span class="nf">new</span>
    <span class="vi">@heading</span> <span class="o">=</span> <span class="s2">"New Post"</span>
    <span class="n">proffer</span> <span class="ss">:post</span> <span class="o">=&gt;</span> <span class="no">Post</span><span class="o">.</span><span class="n">new</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>


<p>Any proffered values will then be available to your views by their key:</p>

<div class="highlight">
<pre><span class="cp">&lt;%=</span> <span class="n">form_for</span><span class="p">(</span><span class="n">post</span><span class="p">)</span> <span class="k">do</span> <span class="o">|</span><span class="n">f</span><span class="o">|</span> <span class="cp">%&gt;</span><span class="x"></span>
<span class="x">  ...</span>
<span class="cp">&lt;%</span> <span class="k">end</span> <span class="cp">%&gt;</span><span class="x"></span>
</pre>
</div>


<p>You can test your use of Proffer by inspecting the <code>proffered</code> method on your
controllers instead of using <code>assigns</code> like so:</p>

<div class="highlight">
<pre><span class="n">describe</span> <span class="no">FooController</span> <span class="k">do</span>
  <span class="n">describe</span> <span class="s2">"GET index"</span> <span class="k">do</span>
    <span class="n">it</span> <span class="s2">"only proffers the title"</span> <span class="k">do</span>
      <span class="n">get</span> <span class="ss">:index</span>
      <span class="n">controller</span><span class="o">.</span><span class="n">proffered</span><span class="o">.</span><span class="n">should</span> <span class="o">==</span> <span class="p">{</span> <span class="ss">:title</span> <span class="o">=&gt;</span> <span class="s2">"Title"</span> <span class="p">}</span>
    <span class="k">end</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>


<p>Note that if you set <code>@title</code> in a Proffer-enabled action, <code>assigns(:title)</code>
will be <code>nil</code>.</p>

<h3>Compatibility</h3>

<p>As we rely on <code>ActionController#view_assigns</code>, this will only work with versions
of Rails 3.0 or later. It is currently tested against Rails 3.2.</p>

<h3>Disclaimer</h3>

<p>We have not yet tried this in production so proceed with caution. This gem
overrides <code>ActionController#view_assigns</code> and extends <code>ActionController#render</code>,
so it may be incompatible with other gems that override these methods.</p>

<h3>License</h3>

<p>See LICENSE.txt</p>
      </section>
      <footer>
        <p>This project is maintained by <a href="https://github.com/hudge">hudge</a></p>
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </footer>
    </div>
    <!--[if !IE]><script>fixScale(document);</script><!--<![endif]-->
  </body>
</html>